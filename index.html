<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0A0A0A">
    <title>Gamex - Balance Emotion. Unlock Connection.</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
    <div class="splash-screen">
        <canvas id="auraCanvas"></canvas>
        <div class="content">
            <div class="logo-container">
                <h1 class="game-title">GAMEX</h1>
                <p class="tagline">Balance Emotion. Unlock Connection.</p>
            </div>

            <div class="start-section">
                <button id="startBtn" class="primary-btn">
                    <span>START</span>
                </button>
                <p class="info-text">Enable Bluetooth to discover nearby players</p>
            </div>

            <div id="bluetoothStatus" class="status-message hidden"></div>
        </div>
    </div>

    <script src="/js/audio.js"></script>
    <script src="/js/animations.js"></script>
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(reg => {
                console.log('Service Worker registered', reg);
            }).catch(err => {
                console.log('Service Worker registration failed', err);
            });
        }

        // PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        // Initialize animations
        const canvas = document.getElementById('auraCanvas');
        const animations = new AuraAnimations(canvas);
        animations.startAmbientAura();

        // Start button handler
        document.getElementById('startBtn').addEventListener('click', async () => {
            const btn = document.getElementById('startBtn');
            const status = document.getElementById('bluetoothStatus');

            btn.disabled = true;
            btn.innerHTML = '<span>CHECKING...</span>';

            // Check Bluetooth availability
            if (!navigator.bluetooth) {
                status.textContent = 'Bluetooth not supported on this browser. Please use Chrome, Edge, or Opera.';
                status.classList.remove('hidden');
                status.classList.add('error');
                btn.disabled = false;
                btn.innerHTML = '<span>START</span>';
                return;
            }

            // Request Bluetooth permission
            try {
                status.textContent = 'Requesting Bluetooth access...';
                status.classList.remove('hidden', 'error');
                status.classList.add('info');

                // Store user as host and redirect to lobby
                sessionStorage.setItem('isHost', 'true');
                window.location.href = '/lobby.html';
            } catch (error) {
                status.textContent = 'Bluetooth access denied. Please enable Bluetooth and try again.';
                status.classList.add('error');
                btn.disabled = false;
                btn.innerHTML = '<span>START</span>';
            }
        });

        // Haptic feedback for button
        document.getElementById('startBtn').addEventListener('touchstart', () => {
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
        });
    </script>
</body>
</html>
